<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AnimeRashii Admin</title>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/header-anime.css">
    <script src="../js/script.js"></script>
    <style>
        .admin-container label,
        .admin-container b,
        .admin-container div[style*="font-weight:700"] {
            color: #e14b4b !important;
        }
        .admin-container {
            max-width: 700px;
            margin: 40px auto;
            background: #fffbe6;
            border-radius: 18px;
            box-shadow: 0 4px 18px #ffb6e6aa, 0 2px 8px #ffd16699;
            padding: 32px 28px 32px 28px;
        }
        .admin-title {
            font-size: 2.1rem;
            font-family: 'Mochiy Pop One', 'Luckiest Guy', cursive, Arial, sans-serif;
            color: #ff6f61;
            margin-bottom: 18px;
        }
        .admin-section {
            margin-bottom: 32px;
        }
        .admin-section h2 {
            color: #e14b4b;
            font-size: 1.3rem;
            margin-bottom: 10px;
        }
        .admin-btn {
            background: linear-gradient(90deg, #ffd166 0%, #ffb6e6 100%);
            color: #23233a;
            font-weight: 800;
            border: none;
            border-radius: 18px;
            padding: 10px 28px;
            font-size: 1.08rem;
            margin: 8px 0;
            cursor: pointer;
            box-shadow: 0 2px 8px #ffd16699;
            transition: background 0.18s, color 0.18s;
        }
        .admin-btn:hover {
            background: linear-gradient(90deg, #ffb6e6 0%, #ffd166 100%);
            color: #ff6f61;
        }
        .admin-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 12px;
        }
        .admin-table th, .admin-table td {
            border: 1.5px solid #ffd166;
            padding: 8px 10px;
            text-align: left;
        }
        .admin-table th {
            background: #ffd166;
            color: #23233a;
        }
        .admin-table td {
            background: #fff;
        }
        .admin-warning {
            color: #e14b4b;
            font-size: 1.01rem;
            margin-top: 8px;
        }
    </style>
</head>
<body>
    <div id="admin-password-overlay" style="position:fixed;z-index:9999;top:0;left:0;width:100vw;height:100vh;background:rgba(255,255,255,0.98);display:flex;align-items:center;justify-content:center;flex-direction:column;">
        <div style="background:#fff9e6;border:2px solid #ffd166;border-radius:12px;padding:32px 28px;box-shadow:0 2px 16px #0002;min-width:320px;max-width:90vw;">
            <h2 style="margin-bottom:18px;color:#222;font-size:1.4em;">Admin Login</h2>
            <label style="font-size:1.05em;">Password:
                <input id="admin-password-input" type="password" style="margin-left:10px;padding:6px 10px;border-radius:6px;border:1px solid #ffd166;font-size:1em;">
            </label>
            <button id="admin-password-submit" style="margin-left:16px;padding:6px 18px;border-radius:6px;background:#ffd166;color:#222;font-weight:bold;border:none;cursor:pointer;font-size:1em;">Login</button>
            <div id="admin-password-error" style="color:#c00;margin-top:12px;display:none;font-size:1em;">Incorrect password. Try again.</div>
        </div>
    </div>
    <div class="donate-top-cta">
        <span>ðŸ’– Help us stay alive! <a href="https://www.paypal.com/paypalme/palomaresnina" target="_blank" rel="noopener" class="donate-link-top">Donate</a></span>
    </div>
    <header>
        <div class="header-anime-bg"></div>
        <div class="header-content">
            <h1>AnimeRashii Admin</h1>
            <nav>
                <a href="../index.html">Home</a>
                <a href="browse.html">Browse</a>
            </nav>
        </div>
    </header>
    <div class="admin-container">
        <div class="admin-title">Admin Dashboard</div>
        <div class="admin-section">
        <!-- Removed view counts and reset section -->
        </div>
        <div class="admin-section">
        <h2>Add New Anime</h2>
        <form id="add-anime-form" style="margin-bottom:24px;">
            <fieldset style="border:1.5px solid #ffd166; border-radius:12px; padding:18px 14px 10px 14px; background:#fff; margin-bottom:18px;">
                <legend style="color:#e14b4b;font-weight:700;font-size:1.08rem;">Add New Anime</legend>
                <div style="margin-bottom:8px;"><b>Name:</b><br><input type="text" id="new-anime-name" required style="margin:0 0 10px 0; padding:4px 8px; border-radius:6px; border:1px solid #ffd166; width:98%;"></div>
                <!-- ID field removed: ID will be auto-generated from name -->
                <div style="margin-bottom:8px;">
                  <b>Genres</b> <span style="font-size:0.95em; color:#888;">(select one or more)</span>:<br>
                  <select id="new-anime-genres" multiple size="7" style="margin:0 0 10px 0; padding:4px 8px; border-radius:6px; border:1px solid #ffd166; width:98%;">
                    <option value="action">Action</option>
                    <option value="adventure">Adventure</option>
                    <option value="fantasy">Fantasy</option>
                    <option value="drama">Drama</option>
                    <option value="sci-fi">Sci-Fi</option>
                    <option value="mystery">Mystery</option>
                    <option value="supernatural">Supernatural</option>
                    <option value="romance">Romance</option>
                    <option value="psychological">Psychological</option>
                    <option value="thriller">Thriller</option>
                    <option value="music-video">Music-Video</option>
                  </select>
                  <div style="font-size:0.93em;color:#888;">Hold Ctrl (Windows) or Cmd (Mac) to select multiple genres.</div>
                </div>
                <div style="margin-bottom:8px;"><b>Ongoing:</b> <input type="checkbox" id="new-anime-ongoing" style="margin-left:8px;"></div>
                <div style="margin-bottom:8px;"><b>Image URL:</b><br><input type="text" id="new-anime-img" style="margin:0 0 10px 0; padding:4px 8px; border-radius:6px; border:1px solid #ffd166; width:98%;"></div>
                <div style="margin-bottom:8px;"><b>Description:</b><br><textarea id="new-anime-desc" rows="2" style="width:98%;margin:6px 0 10px 0; border-radius:6px; border:1px solid #ffd166; padding:4px 8px;"></textarea></div>
                <div style="margin-bottom:8px;"><b>Trailer URL</b> <span style="font-size:0.95em; color:#888;">(optional)</span>:<br><input type="text" id="new-anime-trailer" style="margin:0 0 10px 0; padding:4px 8px; border-radius:6px; border:1px solid #ffd166; width:98%;"></div>
                <div style="margin-bottom:8px;"><b>Next Episode Date</b> <span style="font-size:0.95em; color:#888;">(optional)</span>:<br><input type="date" id="new-anime-next-ep-date" style="margin:0 0 10px 0; padding:4px 8px; border-radius:6px; border:1px solid #ffd166;"></div>
                <div id="seasons-section" style="margin-top:18px;">
                    <div style="font-weight:700;color:#e14b4b;margin-bottom:6px;">Seasons:</div>
                    <div id="seasons-list"></div>
                    <button type="button" class="admin-btn" id="add-season-btn" style="margin-top:8px;">+ Add Season</button>
                </div>
                <br>
                <button type="submit" class="admin-btn">Add Anime</button>
                <span id="add-anime-success" style="color:#16a34a;font-weight:700;margin-left:12px;display:none;">Anime added (session only)</span>
            </fieldset>
        </form>
        </div>

        <div class="admin-section">
        <h2>Add Season or Episode to Existing Anime</h2>
        <form id="add-episode-form" style="margin-bottom:24px;">
            <fieldset style="border:1.5px solid #ffd166; border-radius:12px; padding:18px 14px 10px 14px; background:#fff; margin-bottom:18px;">
                <legend style="color:#e14b4b;font-weight:700;font-size:1.08rem;">Add Season/Episode</legend>
                <div style="margin-bottom:8px;">
                  <b>Select Anime:</b><br>
                  <select id="existing-anime-select" required style="margin:0 0 10px 0; padding:4px 8px; border-radius:6px; border:1px solid #ffd166; width:98%;"></select>
                </div>
                <div style="margin-bottom:8px;">
                  <b>Action:</b><br>
                  <label><input type="radio" name="add-action" value="season" checked> Add New Season</label>
                  <label style="margin-left:18px;"><input type="radio" name="add-action" value="episode"> Add Episode to Existing Season</label>
                </div>
                <div id="add-season-fields" style="margin-bottom:8px;">
                  <b>Season Title:</b><br><input type="text" id="new-season-title" style="margin:0 0 10px 0; padding:4px 8px; border-radius:6px; border:1px solid #ffd166; width:98%;"><br>
                  <b>Episodes:</b><br><input type="number" id="new-season-episodes" min="1" value="1" style="margin:0 0 10px 0; padding:4px 8px; border-radius:6px; border:1px solid #ffd166; width:98%;">
                </div>
                <div id="add-episode-fields" style="margin-bottom:8px; display:none;">
                  <b>Select Season:</b><br>
                  <select id="existing-season-select" style="margin:0 0 10px 0; padding:4px 8px; border-radius:6px; border:1px solid #ffd166; width:98%;"></select><br>
                  <b>New Total Episodes:</b><br><input type="number" id="new-episode-count" min="1" value="1" style="margin:0 0 10px 0; padding:4px 8px; border-radius:6px; border:1px solid #ffd166; width:98%;">
                  <div id="episode-links-container"></div>
                </div>
                <button type="submit" class="admin-btn">Add</button>
                <span id="add-episode-success" style="color:#16a34a;font-weight:700;margin-left:12px;display:none;">Update successful</span>
            </fieldset>
        </form>
        </div>
    </div>
    <footer style="margin-top:40px;">
        &copy; 2025 AnimeRashii. All rights reserved.
    </footer>
    <script>
    // --- Admin Password Protection Overlay + F12 Restriction ---
    (function() {
        const overlay = document.getElementById('admin-password-overlay');
        const input = document.getElementById('admin-password-input');
        const submit = document.getElementById('admin-password-submit');
        const error = document.getElementById('admin-password-error');
        let f12Handler = function(e) {
            // Block F12, Ctrl+Shift+I, Ctrl+Shift+J, Ctrl+U, Ctrl+Shift+C
            if (
                e.key === 'F12' ||
                (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'J' || e.key === 'C')) ||
                (e.ctrlKey && e.key === 'u')
            ) {
                e.preventDefault();
                e.stopPropagation();
                return false;
            }
        };
        let contextMenuHandler = function(e) {
            // Block right-click context menu when overlay is visible
            e.preventDefault();
            e.stopPropagation();
            return false;
        };
        // Focus input on load
        setTimeout(() => { input.focus(); }, 100);
        // Attempt to close DevTools if open (works in Chromium-based browsers)
        function blockIfDevToolsOpen() {
            // Use a more robust detection for DevTools
            let threshold = 160;
            let devtoolsOpen = false;
            // Only check if window is not maximized (to avoid false positives)
            if (
                (window.outerWidth > 0 && window.innerWidth > 0 && window.outerWidth - window.innerWidth > threshold) ||
                (window.outerHeight > 0 && window.innerHeight > 0 && window.outerHeight - window.innerHeight > threshold)
            ) {
                devtoolsOpen = true;
            }
            // Remove timing/debugger check to avoid false positives
            if (devtoolsOpen) {
                document.body.innerHTML = '<div style="display:flex;align-items:center;justify-content:center;height:100vh;background:#fffbe6;"><div style="background:#fff9e6;border:2px solid #ffd166;border-radius:12px;padding:32px 28px;box-shadow:0 2px 16px #0002;min-width:320px;max-width:90vw;text-align:center;"><h2 style="color:#e14b4b;">Access Denied</h2><p style="color:#222;font-size:1.1em;">Admin page cannot be accessed while browser DevTools is open.<br>Please close DevTools and reload the page.</p></div></div>';
                document.body.style.overflow = 'hidden';
                document.body.style.pointerEvents = 'none';
                document.body.style.userSelect = 'none';
            }
        }
        function enableF12Block() {
            window.addEventListener('keydown', f12Handler, true);
            window.addEventListener('contextmenu', contextMenuHandler, true);
        }
        function disableF12Block() {
            window.removeEventListener('keydown', f12Handler, true);
            window.removeEventListener('contextmenu', contextMenuHandler, true);
        }
        function checkPassword() {
            if (input.value === 'nina93200!admin') {
                overlay.style.display = 'none';
                input.value = '';
                error.style.display = 'none';
                disableF12Block();
            } else {
                error.style.display = 'block';
                input.value = '';
                input.focus();
            }
        }
        submit.onclick = checkPassword;
        input.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') checkPassword();
        });
        // Prevent interaction with page until unlocked
        document.addEventListener('DOMContentLoaded', function() {
            blockIfDevToolsOpen();
            overlay.style.display = '';
            enableF12Block();
        });
    })();
    // --- Dynamic Seasons/Episodes Form Logic ---
    const seasonsList = document.getElementById('seasons-list');
    let seasonCount = 0;
    function createSeasonBlock(idx) {
        const div = document.createElement('div');
        div.className = 'season-block';
        div.style = 'border:1px solid #ffd166; border-radius:10px; margin-bottom:14px; padding:10px 8px; background:#fff9e6;';
        div.innerHTML = `
            <label>Title: <input type="text" class="season-title" required style="margin:0 10px 10px 0; padding:4px 8px; border-radius:6px; border:1px solid #ffd166;"></label>
            <label>Episodes: <input type="number" min="0" class="season-episodes" value="0" style="margin:0 10px 10px 0; width:60px; border-radius:6px; border:1px solid #ffd166;"></label>
            <button type="button" class="admin-btn remove-season-btn" style="padding:2px 12px; font-size:0.95rem; margin-bottom:8px;">Remove</button>
        `;
        // Remove button logic
        div.querySelector('.remove-season-btn').onclick = function() {
            div.remove();
        };
        return div;
    }
    document.getElementById('add-season-btn').onclick = function() {
        seasonsList.appendChild(createSeasonBlock(++seasonCount));
    };
    // --- Add Anime Submit Handler (API) ---
    document.getElementById('add-anime-form').addEventListener('submit', async function(e) {
        e.preventDefault();
        const name = document.getElementById('new-anime-name').value.trim();
        // Generate ID from name: lowercase, replace spaces with '-', remove special chars
        const id = name
            .toLowerCase()
            .replace(/[^a-z0-9\s-]/g, '') // remove special chars
            .replace(/\s+/g, '-')         // spaces to dash
            .replace(/-+/g, '-')           // collapse multiple dashes
            .replace(/^-+|-+$/g, '');      // trim dashes
        // Get selected genres from multi-select
        const genres = Array.from(document.getElementById('new-anime-genres').selectedOptions).map(opt => opt.value);
        const ongoing = document.getElementById('new-anime-ongoing').checked;
        const img = document.getElementById('new-anime-img').value.trim();
        const desc = document.getElementById('new-anime-desc').value.trim();
        const trailer = document.getElementById('new-anime-trailer').value.trim();
        const nextEpDate = document.getElementById('new-anime-next-ep-date').value;
        // Seasons
        const seasonBlocks = Array.from(document.querySelectorAll('.season-block'));
        const seasons = seasonBlocks.map(block => {
            const title = block.querySelector('.season-title').value.trim() || "Season";
            const episodes = parseInt(block.querySelector('.season-episodes').value, 10) || 0;
            return { title, episodes, videos: [], videosDub: [], videosFrSub: [], videosFrDub: [] };
        });
        if (!name || !id) return;
        // Check for duplicate name or id via API
        let warn = document.getElementById('add-anime-warning');
        if (!warn) {
            warn = document.createElement('div');
            warn.id = 'add-anime-warning';
            warn.className = 'admin-warning';
            this.querySelector('fieldset').appendChild(warn);
        }
        // Fetch all anime to check for duplicates
        const animeList = await fetch('https://my-anime-l74v.onrender.com/api/anime').then(r => r.json());
        const duplicate = animeList.some(anime => anime.id === id || anime.name.toLowerCase() === name.toLowerCase());
        if (duplicate) {
            warn.textContent = 'Anime with this name or ID already exists. Meant to add a new episode? Use the other form.';
            warn.style.display = 'block';
            return;
        } else {
            warn.textContent = '';
            warn.style.display = 'none';
        }
        // Add to backend
        const animeObj = { id, name, desc, img, genres, seasons, ongoing };
        if (trailer) animeObj.trailer = trailer;
        if (nextEpDate) animeObj.nextEpisodeDate = nextEpDate;
        const resp = await fetch('https://my-anime-l74v.onrender.com/api/anime', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(animeObj)
        });
        if (resp.ok) {
            document.getElementById('add-anime-success').style.display = 'inline';
            setTimeout(() => { document.getElementById('add-anime-success').style.display = 'none'; }, 2000);
            this.reset();
            seasonsList.innerHTML = '';
            renderAdminAnimeTable();
        } else {
            warn.textContent = 'Failed to add anime (server error).';
            warn.style.display = 'block';
        }
    });
    // Populate anime list table from backend
    async function renderAdminAnimeTable() {
        const tbody = document.querySelector('#admin-anime-table tbody');
        if (!tbody) return;
        tbody.innerHTML = '';
        const animeList = await fetch('https://my-anime-l74v.onrender.com/api/anime').then(r => r.json());
        animeList.forEach(anime => {
            const tr = document.createElement('tr');
            tr.innerHTML = `<td>${anime.name}</td><td>${anime.id}</td><td>${(anime.genres||[]).join(', ')}</td><td>${anime.ongoing ? 'Yes' : 'No'}</td>`;
            tbody.appendChild(tr);
        });
    }
    document.addEventListener('DOMContentLoaded', function() {
        renderAdminAnimeTable();
        // Auto-generate and preview ID as user types name
        const nameInput = document.getElementById('new-anime-name');
        let idPreview = document.getElementById('anime-id-preview');
        if (!idPreview) {
            idPreview = document.createElement('div');
            idPreview.id = 'anime-id-preview';
            idPreview.style = 'color:#888;font-size:0.98em;margin-bottom:8px;';
            nameInput.parentElement.appendChild(idPreview);
        }
        nameInput.addEventListener('input', function() {
            const id = this.value
                .toLowerCase()
                .replace(/[^a-z0-9\s-]/g, '')
                .replace(/\s+/g, '-')
                .replace(/-+/g, '-')
                .replace(/^-+|-+$/g, '');
            idPreview.textContent = id ? `ID: ${id}` : '';
        });
    });
    // --- Add Season/Episode Form Logic ---
    const addEpisodeForm = document.getElementById('add-episode-form');
    const animeSelect = document.getElementById('existing-anime-select');
    const seasonSelect = document.getElementById('existing-season-select');
    const addSeasonFields = document.getElementById('add-season-fields');
    const addEpisodeFields = document.getElementById('add-episode-fields');
    const addEpisodeSuccess = document.getElementById('add-episode-success');
    let animeDataCache = [];

    async function populateAnimeSelect() {
        animeSelect.innerHTML = '';
        animeDataCache = await fetch('https://my-anime-l74v.onrender.com/api/anime').then(r => r.json());
        animeDataCache.forEach(anime => {
            const opt = document.createElement('option');
            opt.value = anime.id;
            opt.textContent = anime.name;
            animeSelect.appendChild(opt);
        });
        populateSeasonSelect();
    }

    function populateSeasonSelect() {
        seasonSelect.innerHTML = '';
        const anime = animeDataCache.find(a => a.id === animeSelect.value);
        if (!anime || !anime.seasons) return;
        anime.seasons.forEach((season, idx) => {
            const opt = document.createElement('option');
            opt.value = idx;
            opt.textContent = season.title || `Season ${idx+1}`;
            seasonSelect.appendChild(opt);
        });
    }

    animeSelect.addEventListener('change', populateSeasonSelect);

    addEpisodeForm.querySelectorAll('input[name="add-action"]').forEach(radio => {
        radio.addEventListener('change', function() {
            if (this.value === 'season') {
                addSeasonFields.style.display = '';
                addEpisodeFields.style.display = 'none';
            } else {
                addSeasonFields.style.display = 'none';
                addEpisodeFields.style.display = '';
                updateEpisodeLinksInputs();
            }
        });
    });

    addEpisodeForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        const animeId = animeSelect.value;
        const action = addEpisodeForm.querySelector('input[name="add-action"]:checked').value;
        let updatedAnime = animeDataCache.find(a => a.id === animeId);
        if (!updatedAnime) return;
        if (action === 'season') {
            // Add new season
            const title = document.getElementById('new-season-title').value.trim() || `Season ${updatedAnime.seasons.length+1}`;
            const episodes = parseInt(document.getElementById('new-season-episodes').value, 10) || 1;
            updatedAnime.seasons.push({ title, episodes, videos: [], videosDub: [], videosFrSub: [], videosFrDub: [] });
        } else {
            // Add episode to existing season
            const seasonIdx = parseInt(seasonSelect.value, 10);
            const newEpCount = parseInt(document.getElementById('new-episode-count').value, 10) || 1;
            if (updatedAnime.seasons[seasonIdx]) {
                // Update episode count
                updatedAnime.seasons[seasonIdx].episodes = newEpCount;
                // Collect links for each episode and language
                const links = collectEpisodeLinksInputs(newEpCount);
                updatedAnime.seasons[seasonIdx].videos = links.videos;
                updatedAnime.seasons[seasonIdx].videosDub = links.videosDub;
                updatedAnime.seasons[seasonIdx].videosFrSub = links.videosFrSub;
                updatedAnime.seasons[seasonIdx].videosFrDub = links.videosFrDub;
            }
        }
        // Send PATCH to backend
        const resp = await fetch(`https://my-anime-l74v.onrender.com/api/anime/${animeId}`, {
            method: 'PATCH',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ seasons: updatedAnime.seasons })
        });
        if (resp.ok) {
            addEpisodeSuccess.style.display = 'inline';
            setTimeout(() => { addEpisodeSuccess.style.display = 'none'; }, 2000);
            await populateAnimeSelect();
            updateEpisodeLinksInputs();
        }
    });
    // --- Dynamic Episode Links Inputs ---
    function updateEpisodeLinksInputs() {
        const container = document.getElementById('episode-links-container');
        container.innerHTML = '';
        const count = parseInt(document.getElementById('new-episode-count').value, 10) || 1;
        for (let i = 0; i < count; i++) {
            const block = document.createElement('div');
            block.className = 'episode-links-block';
            block.style = 'border:1px solid #ffd166; border-radius:8px; margin-bottom:10px; padding:8px 6px; background:#fff9e6;';
            block.innerHTML = `
                <div style="font-weight:700;color:#e14b4b;margin-bottom:4px;">Episode ${i+1} Links:</div>
                <label>Sub: <input type="text" class="ep-link-sub" data-ep="${i}" style="margin:0 8px 6px 0; width:180px; border-radius:6px; border:1px solid #ffd166;"></label>
                <label>Dub: <input type="text" class="ep-link-dub" data-ep="${i}" style="margin:0 8px 6px 0; width:180px; border-radius:6px; border:1px solid #ffd166;"></label>
                <label>FrSub: <input type="text" class="ep-link-frsub" data-ep="${i}" style="margin:0 8px 6px 0; width:180px; border-radius:6px; border:1px solid #ffd166;"></label>
                <label>FrDub: <input type="text" class="ep-link-frdub" data-ep="${i}" style="margin:0 8px 6px 0; width:180px; border-radius:6px; border:1px solid #ffd166;"></label>
            `;
            container.appendChild(block);
        }
    }

    function collectEpisodeLinksInputs(count) {
        const videos = [];
        const videosDub = [];
        const videosFrSub = [];
        const videosFrDub = [];
        for (let i = 0; i < count; i++) {
            videos[i] = document.querySelector(`.ep-link-sub[data-ep="${i}"]`)?.value.trim() || '';
            videosDub[i] = document.querySelector(`.ep-link-dub[data-ep="${i}"]`)?.value.trim() || '';
            videosFrSub[i] = document.querySelector(`.ep-link-frsub[data-ep="${i}"]`)?.value.trim() || '';
            videosFrDub[i] = document.querySelector(`.ep-link-frdub[data-ep="${i}"]`)?.value.trim() || '';
        }
        return { videos, videosDub, videosFrSub, videosFrDub };
    }

    // Update episode links inputs when episode count changes
    document.getElementById('new-episode-count').addEventListener('input', function() {
        updateEpisodeLinksInputs();
    });

    // Also update when switching anime/season
    animeSelect.addEventListener('change', function() {
        if (addEpisodeForm.querySelector('input[name="add-action"]:checked').value === 'episode') {
            updateEpisodeLinksInputs();
        }
    });
    seasonSelect.addEventListener('change', function() {
        if (addEpisodeForm.querySelector('input[name="add-action"]:checked').value === 'episode') {
            updateEpisodeLinksInputs();
        }
    });

    document.addEventListener('DOMContentLoaded', function() {
        renderAdminAnimeTable();
        // Auto-generate and preview ID as user types name
        const nameInput = document.getElementById('new-anime-name');
        let idPreview = document.getElementById('anime-id-preview');
        if (!idPreview) {
            idPreview = document.createElement('div');
            idPreview.id = 'anime-id-preview';
            idPreview.style = 'color:#888;font-size:0.98em;margin-bottom:8px;';
            nameInput.parentElement.appendChild(idPreview);
        }
        nameInput.addEventListener('input', function() {
            const id = this.value
                .toLowerCase()
                .replace(/[^a-z0-9\s-]/g, '')
                .replace(/\s+/g, '-')
                .replace(/-+/g, '-')
                .replace(/^-+|-+$/g, '');
            idPreview.textContent = id ? `ID: ${id}` : '';
        });
        // Populate anime/season selects for add-episode form
        populateAnimeSelect();
    });
    </script>
</body>
</html>
